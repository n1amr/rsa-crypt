#!/bin/bash

TARGET="./singlefile/rsa-crypt.cpp"

files=(
    "main/bigint/BigInt.h"
    "main/bigint/BigIntHelpers.h"
    "main/App.h"
    "main/bigint/BigInt.cpp"
    "main/bigint/BigIntHelpers.cpp"
    "main/App.cpp"
    "main/main.cpp"
)

includes=(
    iostream
    string
    sstream
    fstream
    vector
    map
    algorithm
    cassert
    ctime
)

echo "//" > "$TARGET"
echo "// Author: Amr Alaa" >> "$TARGET"
echo "//" >> "$TARGET"
echo "// WARNING: Auto generated file. All changes will be lost!" >> "$TARGET"
echo "//" >> "$TARGET"
echo >> "$TARGET"
for i in "${includes[@]}"; do
    echo "#include <$i>" >> "$TARGET"
done
echo "using namespace std;" >> "$TARGET"

for f in "${files[@]}"; do
    echo >> "$TARGET"
    echo "// ================================================================================" >> "$TARGET"
    echo "// BEGIN_FILE {{ $f" >> "$TARGET"
    echo "//" >> "$TARGET"
    cat "./src/$f" >> "$TARGET"
    echo >> "$TARGET"
    echo "//" >> "$TARGET"
    echo "// END_FILE $f }};" >> "$TARGET"
    echo "// ================================================================================" >> "$TARGET"
done

cat "$TARGET" | grep -Pv '\s*assert\(' > "${TARGET}.tmp"
mv -f "${TARGET}.tmp" "${TARGET}"
