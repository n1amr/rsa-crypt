#!/bin/bash

TARGET="./rsa-crypt.cpp"

files=(
    "bigint/BigInt.h"
    "bigint/BigIntHelpers.h"
    "App.h"
    "bigint/BigInt.cpp"
    "bigint/BigIntHelpers.cpp"
    "App.cpp"
    "main.cpp"
)

includes=(
    iostream
    string
    sstream
    fstream
    vector
    map
    algorithm
    cassert
)

echo "//" > "$TARGET"
echo "// NOTE: AUTO GENERATED FILES DO NOT EDIT" >> "$TARGET"
echo "//" >> "$TARGET"
echo >> "$TARGET"
for i in "${includes[@]}"; do
    echo "#include<$i>" >> "$TARGET"
done
echo "using namespace std;" >> "$TARGET"

for f in "${files[@]}"; do
    echo >> "$TARGET"
    echo "//" >> "$TARGET"
    echo "// #BEGIN_FILE {{{ $f" >> "$TARGET"
    echo "//" >> "$TARGET"
    cat "./src/$f" >> "$TARGET"
    echo >> "$TARGET"
    echo "//" >> "$TARGET"
    echo "// #END_FILE $f }}}" >> "$TARGET"
    echo "//" >> "$TARGET"
done

cat "$TARGET" | grep -Pv '\s*assert\(' > "${TARGET}.tmp"
mv -f "${TARGET}.tmp" "${TARGET}"
